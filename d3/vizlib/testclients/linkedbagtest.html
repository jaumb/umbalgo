<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>D3 Test</title>
    <script type="text/javascript" src="../d3.v3.js"></script>
    <script type="text/javascript" src="../common.js"></script>
    <script type="text/javascript" src="../factories/element_factory.js">
    </script>
    <script type="text/javascript" src="../factories/ll_factory.js"></script>
    <script type="text/javascript" src="../algorithms/linkedbag.js"></script>
    <script type="text/javascript" src="../vizlib.js"></script>
    <script type="text/javascript" src="../redraw.js"></script>
  </head>
  <body>
    <div class="chart-container" style="max-width: 1000px;"></div>
    <script type="text/javascript">
      var svgW = window.innerWidth;
      var svgH = window.innerHeight;

      d3.select(".chart-container")
        .append("svg")
        .attr("width", svgW)
        .attr("height", svgH)
        .attr('id','svg_canvas');
      redraw.initialize();

      // example of a client using the insertion visualization
      var dur = 15000;

      // linked node factory definition ////////////////////////////////////////
      var linkedNode_factory = (function() {
        function LinkedNode(id, val, next) {
          var _id = id;
          var _val = val;
          var _next = next;

          var getID = function() {
            return _id;
          }

          var getVal = function() {
            return _val;
          }

          var setVal = function(newVal) {
            _val = newVal;
          }

          var getNext = function() {
            return _next;
          }

          var setNext = function (newNext) {
            _next = newNext;
          }

          return {
            getID:getID,
            getVal:getVal,
            setVal:setVal,
            getNext:getNext,
            setNext:setNext
          }
        }

        var getNode = function(id, val, next) {
          return new LinkedNode(id, val, next);
        }

        return {
          getNode:getNode
        }
      })();
      // end linked node factory definition ////////////////////////////////////

      var size = 5;
      var l = [];
      for (var i = 1; i <= size; i++) {
        l.push(i);
      }
      d3.shuffle(l);


      var nodes = [];
      for (var i = 1; i <= size; i++) {
        nodes.push(linkedNode_factory.getNode(i, l[i-1], null));
      }
      for (var i = 0; i <= size - 2; i++) {
        nodes[i].setNext(nodes[i + 1])
      }
      var root = nodes[0];


      var newNode = linkedNode_factory.getNode(1, 5, null);



      var viz = vizlib.get_linkedbag(null, svgW, svgH);

      // var viz = vizlib.get_linkedbag(n, svgW, svgH);
      redraw.draw(viz, dur); // draw initial canvas

      // redraw.addOpsAndDraw(viz, dur,
      //                      viz.showOldFirst());
      //
      // redraw.addOpsAndDraw(viz, dur,
      //                     viz.addNodeFront(newNode));
      //
      // redraw.addOpsAndDraw(viz, dur,
      //                     viz.showNode(newNode.getID()));

      var first = null;
      var _ID = 1;

      function add(val) {
        // java: Node oldfirst = first;
        var oldfirst = first;
        // fade in oldfirst ref
        redraw.addOpsAndDraw(viz, dur,
                             viz.showOldFirst());

        // java: first = new Node();
        first = linkedNode_factory.getNode(_ID++, val, first);
        // add a node to front, resize elements, show node box (label hidden),
        // point first ref's arrow at new node
        redraw.addOpsAndDraw(viz, dur,
                            viz.addNodeFront(first),
                            viz.showNodeBox(first.getID()),
                            viz.pointFirstAt(1));

        // java: first.item = item;
        // fade label of new element into view
        redraw.addOpsAndDraw(viz, dur,
                            viz.showNodeLabel(first.getID()));

        // java: first.next = oldfirst;
        // new element points to whatever oldfirst references
        redraw.addOpsAndDraw(viz, dur,
                            viz.pointNodeAtOldfirst(first.getID()));

        // java: n++;
        redraw.addOpsAndDraw(viz, dur,
                              viz.hideNLabel());
        redraw.addOpsAndDraw(viz, dur,
                              viz.updateN(),
                              viz.showNLabel());

        redraw.addOpsAndDraw(viz, dur,
                              viz.hideOldFirst());
      }

      add(5);
      add(2);
      add(4);



      // redraw.addOpsAndDraw(viz, dur,
      //                      viz.setFill([1,3,5], colors.FINISHED),
      //                      viz.setFirstFill(colors.ACTIVE));
      //
      // redraw.addOpsAndDraw(viz, 3000,
      //                     viz.showOldFirst());
      //
      // redraw.addOpsAndDraw(viz, 3000,
      //                     viz.shiftRight());

    </script>
  </body>
</html>
