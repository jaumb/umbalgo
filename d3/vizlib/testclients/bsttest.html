<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>D3 Test</title>
    <script type="text/javascript" src="https://d3js.org/d3.v4.min.js"></script>
    <script type="text/javascript" src="../common.js"></script>
    <script type="text/javascript" src="../factories/element_factory.js">
    </script>
    <script type="text/javascript" src="../factories/tree_factory.js"></script>
    <script type="text/javascript" src="../algorithms/bst.js"></script>
    <script type="text/javascript" src="../vizlib.js"></script>
    <script type="text/javascript" src="../redraw.js"></script>
  </head>
  <body>
    <div class="chart-container" style="max-width: 1000px;"></div>
    <script type="text/javascript">
      var svgW = window.innerWidth;
      var svgH = window.innerHeight;
      window.onresize = resize;

      d3.select(".chart-container")
        .append("svg")
        .attr("width", svgW)
        .attr("height", svgH)
        .attr('id',svgCanvasName);

      // duration for visualization
      var dur = 500;
      var root = null;
      var ids = 1;

      // get the BST visualization
      var viz = vizlib.get_bst(root, svgW, svgH);

      // get 5 randomly ordered integers
      elements = d3.range(1,6);
      d3.shuffle(elements);

      ////////////////////////// MAIN LOOP ////////////////////////////////////
      // visualize inserting elements one at a time

      elements.forEach(function(e) {
        var newElem = new node(ids++, e, null, null);
        viz.dispNextNodeAndUpdate(newElem, dur);
        root = addNode(root, newElem);
        viz.buildTreeAndUpdate(root, dur);
        viz.clearEmphasesAndUpdate(dur);
      });

      // start the visualization once we finish building the tree
      viz.playpause();

      // add a node to the tree rooted at rootNode
      function addNode(rootNode, newNode) {
        if (!rootNode) {
          return newNode;
        } else if (newNode.val() > rootNode.val()) {
          viz.emphasizeAndUpdate([rootNode], dur);
          viz.setFillAndUpdate([rootNode, newNode], colors.COMPARE, dur);
          viz.setFillAndUpdate([rootNode, newNode], colors.BACKGROUND, dur);
          viz.moveEmphasisAndUpdate(rootNode, rootNode.rChild(), 1, dur);
          rootNode.setRChild(addNode(rootNode.rChild(), newNode));
        } else if (newNode.val() < rootNode.val()) {
          viz.emphasizeAndUpdate([rootNode], dur);
          viz.setFillAndUpdate([rootNode, newNode], colors.COMPARE, dur);
          viz.setFillAndUpdate([rootNode, newNode], colors.BACKGROUND, dur);
          viz.moveEmphasisAndUpdate(rootNode, rootNode.lChild(), -1, dur);
          rootNode.setLChild(addNode(rootNode.lChild(), newNode));
        } else {
          // deal with equal keys here
        }
        return rootNode;
      }

      // remove a node from the tree rooted at rootNode
      function removeNode(rootNode, newNode) {
        if (!rootNode) {
          return null;
        } else if (newNode.val() > rootNode.val()) {
          viz.emphasizeAndUpdate([rootNode], dur);
          viz.setFillAndUpdate([rootNode, newNode], colors.COMPARE, dur);
          viz.setFillAndUpdate([rootNode, newNode], colors.BACKGROUND, dur);
          viz.moveEmphasisAndUpdate(rootNode, rootNode.rChild(), 1, dur);
          rootNode.setRChild(successor(rootNode.rChild(), newNode));
        } else if (newNode.val() < rootNode.val()) {
          viz.emphasizeAndUpdate([rootNode], dur);
          viz.setFillAndUpdate([rootNode, newNode], colors.COMPARE, dur);
          viz.setFillAndUpdate([rootNode, newNode], colors.BACKGROUND, dur);
          viz.moveEmphasisAndUpdate(rootNode, rootNode.lChild(), -1, dur);
          rootNode.setLChild(successor(rootNode.lChild(), newNode));
        }
        return rootNode;
      }

      // find the successor of node in the tree rooted at rootNode
      function successor(rootNode, node) {
        
      }

      // tree node representation
      // id(), val(), lChild(), and rChild() are expected by tree visualizations
      function node(uid, nodeVal, lc, rc) {
        var _id = uid;
        var _val = nodeVal;
        var _lc = lc;
        var _rc = rc;

        var id = function() { return _id; }
        var val = function() { return _val; }
        var lChild = function() { return _lc; }
        var rChild = function() { return _rc; }
        var setLChild = function(child) { _lc = child; }
        var setRChild = function(child) { _rc = child; }

        return {
          id:id,
          val:val,
          lChild:lChild,
          rChild:rChild,
          setLChild:setLChild,
          setRChild:setRChild
        };
      }

      function resize() {
        svgW = window.innerWidth;
        svgH = window.innerHeight;
        viz.resize(viz, svgW, svgH);
      }

    </script>
  </body>
</html>
